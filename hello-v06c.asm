    ; üêü –¥–ª—è –í–µ–∫—Ç–æ—Ä–∞-06—Ü
    .binfile helv06c.rom
    .download bin  
    .tape v06c-rom

    rastint equ 38h ; –ø—Ä–µ—Ä–≤—ã–≤–∞–Ω–∏–µ –æ–±—Ä–∞—Ç–Ω–æ–≥–æ —Ö–æ–¥–∞ –ª—É—á–∞

    .org 100h
    ; —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ .rom —Ñ–∞–π–ª–∞ 
    di              ; –∑–∞–ø—Ä–µ—Ç–∏—Ç—å –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è
    xra a               
    out 10h         ; –≤—ã–∫–ª—é—á–∏—Ç—å –∫–≤–∞–∑–∏–¥–∏—Å–∫ 
    lxi sp, $100    ; –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —É–∫–∞–∑–∞—Ç–µ–ª—å —Å—Ç–µ–∫–∞

    mvi a, 0c9h     ; –∫–æ–¥ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ RET
    sta rastint     ; –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ RST7

    call clrscr     ; –æ—á–∏—Å—Ç–∏—Ç—å —ç–∫—Ä–∞–Ω
    call set_palette; —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–∞–ª–∏—Ç—Ä—É

    ; –∑–∞–¥–∞—Ç—å –ø–æ–∑–∏—Ü–∏—é –≤—ã–≤–æ–¥–∞ —Ç–µ–∫—Å—Ç–∞
    ; —Å—Ç–æ–ª–±–µ—Ü 0, —Å—Ç—Ä–æ–∫–∞ $f8 (–≤–µ—Ä—Ö —ç–∫—Ä–∞–Ω–∞)
    lxi h, $00f8    
    call gotoxy

    ; –≤—ã–≤–µ—Å—Ç–∏ —Å—Ç—Ä–æ–∫—É
    lxi h, msg
    call puts

    ; —ç–ª–µ–≥–∞–Ω—Ç–Ω–æ –∑–∞–≤–∏—Å–Ω—É—Ç—å
    di
    hlt

msg:
    db 'HELLO, WORLD!',0

    ;
    ; –ú–∏–∫—Ä–æ-–±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è –í–µ–∫—Ç–æ—Ä–∞-06—Ü
    ;

    ; –û–±–ª–∞—Å—Ç—å –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è SP
__savedsp dw 0

    ; –û—á–∏—Å—Ç–∫–∞ –≤—Å–µ–π —ç–∫—Ä–∞–Ω–Ω–æ–π –æ–±–ª–∞—Å—Ç–∏
clrscr
    di
    lxi h,0
    dad sp
    shld __savedsp

    lxi sp, 0
    lxi b, 0
    lxi d, $1000
_clrscr_1:
    push b
    push b
    push b
    push b
    dcx d
    mov a, d
    ora e
    jnz _clrscr_1

    lhld __savedsp
    sphl
    ret

    ; –ü—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞–ª–∏—Ç—Ä—ã
set_palette
    ei
    hlt

    mvi a, 88h      ; –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ü–ü–ò
    out 0

    mvi a, 255      ; —Å–±—Ä–æ—Å–∏—Ç—å –ø—Ä–æ–∫—Ä—É—Ç–∫—É
    out 03

    mvi c, $f       ; –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞–ª–∏—Ç—Ä—ã
    mvi b, $00
_set_palette_1:
    mov a,c
    out 2
    mov a, b
    out $c
    out $c
    out $c
    out $c
    cma
    mov b, a
    dcr c
    jp _set_palette_1
    ret

    ; —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–æ–∑–∏—Ü–∏—é –¥–ª—è –≤—ã–≤–æ–¥–∞ —Å–ª–µ–¥—É—é—â–µ–≥–æ —Å–∏–º–≤–æ–ª–∞
    ; H = —Å—Ç–æ–ª–±–µ—Ü, L = —Å—Ç—Ä–æ–∫–∞ ($F8 = –≤–µ—Ä—Ö–Ω—è—è)
gotoxy
    shld _puts_de
    ret

    ; –í—ã–≤–µ—Å—Ç–∏ 0-—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω—É—é —Å—Ç—Ä–æ–∫—É –≤ HL –Ω–∞ —ç–∫—Ä–∞–Ω
puts
    shld _puts_sptr
_puts_1:
    call _putchar
    jnz _puts_1
    ret

_puts_sptr:dw 0
_puts_de: dw 0

    ; –ù–∞—Ä–∏—Å–æ–≤–∞—Ç—å –æ–¥–∏–Ω —Å–∏–º–≤–æ–ª
_putchar:
    lhld _puts_sptr
    mov a, m
    ora a
    rz
    mov c, a
    inx h
    shld _puts_sptr
    xchg
    lhld _puts_de
    inr h
    shld _puts_de
    xchg

    lxi h,0
    dad sp
    shld __savedsp

    ; –ù–∞–π—Ç–∏ –∞–¥—Ä–µ—Å —Å–ø—Ä–∞–π—Ç–∞ —Å–∏–º–≤–æ–ª–∞
    ; bc = (c-32)*8
    mov a,c
    sui 32
    mov c, a
    rlc
    rlc
    rlc
    ani 7
    mov b,a
    mov a,c
    rlc
    rlc
    rlc
    ani $f8
    mov c,a
    lxi h, _font_table
    dad b
    sphl        ; sp -> char

    lxi h, $e000
    dad d        ; hl -> destination

    ; –í—ã–¥–∞–≤–∏—Ç—å –±–∏—Ç—ã –Ω–∞ —ç–∫—Ä–∞–Ω
    pop b
    mov m, c
    dcr l
    mov m, b
    dcr l
    pop b
    mov m, c
    dcr l
    mov m, b
    dcr l
    pop b
    mov m, c
    dcr l
    mov m, b
    dcr l
    pop b
    mov m, c
    dcr l
    mov m, b
    dcr l

    lhld __savedsp
    sphl
    mvi a, 1
    ret    

_font_table:
    ; Font: 8X8!FONT.pf
    db    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00    
    db    0x30, 0x78, 0x78, 0x30, 0x30, 0x00, 0x30, 0x00    
    db    0x6C, 0x6C, 0x6C, 0x00, 0x00, 0x00, 0x00, 0x00    
    db    0x6C, 0x6C, 0xFE, 0x6C, 0xFE, 0x6C, 0x6C, 0x00    
    db    0x30, 0x7C, 0xC0, 0x78, 0x0C, 0xF8, 0x30, 0x00    
    db    0x00, 0xC6, 0xCC, 0x18, 0x30, 0x66, 0xC6, 0x00    
    db    0x38, 0x6C, 0x38, 0x76, 0xDC, 0xCC, 0x76, 0x00    
    db    0x60, 0x60, 0xC0, 0x00, 0x00, 0x00, 0x00, 0x00    
    db    0x18, 0x30, 0x60, 0x60, 0x60, 0x30, 0x18, 0x00    
    db    0x60, 0x30, 0x18, 0x18, 0x18, 0x30, 0x60, 0x00    
    db    0x00, 0x66, 0x3C, 0xFF, 0x3C, 0x66, 0x00, 0x00    
    db    0x00, 0x30, 0x30, 0xFC, 0x30, 0x30, 0x00, 0x00    
    db    0x00, 0x00, 0x00, 0x00, 0x00, 0x30, 0x30, 0x60    
    db    0x00, 0x00, 0x00, 0xFC, 0x00, 0x00, 0x00, 0x00    
    db    0x00, 0x00, 0x00, 0x00, 0x00, 0x30, 0x30, 0x00    
    db    0x06, 0x0C, 0x18, 0x30, 0x60, 0xC0, 0x80, 0x00    
    db    0x7C, 0xC6, 0xCE, 0xDE, 0xF6, 0xE6, 0x7C, 0x00    
    db    0x30, 0x70, 0x30, 0x30, 0x30, 0x30, 0x30, 0x00    
    db    0x78, 0xCC, 0x0C, 0x38, 0x60, 0xC0, 0xFC, 0x00    
    db    0x78, 0xCC, 0x0C, 0x38, 0x0C, 0xCC, 0x78, 0x00    
    db    0x1C, 0x3C, 0x6C, 0xCC, 0xFE, 0x0C, 0x0C, 0x00    
    db    0xFC, 0xC0, 0xF8, 0x0C, 0x0C, 0xCC, 0x78, 0x00    
    db    0x38, 0x60, 0xC0, 0xF8, 0xCC, 0xCC, 0x78, 0x00    
    db    0xFC, 0x0C, 0x0C, 0x18, 0x30, 0x30, 0x30, 0x00    
    db    0x78, 0xCC, 0xCC, 0x78, 0xCC, 0xCC, 0x78, 0x00    
    db    0x78, 0xCC, 0xCC, 0x7C, 0x0C, 0x18, 0x70, 0x00    
    db    0x00, 0x30, 0x30, 0x00, 0x00, 0x30, 0x30, 0x00    
    db    0x00, 0x30, 0x30, 0x00, 0x00, 0x30, 0x30, 0x60    
    db    0x18, 0x30, 0x60, 0xC0, 0x60, 0x30, 0x18, 0x00    
    db    0x00, 0x00, 0xFC, 0x00, 0x00, 0xFC, 0x00, 0x00    
    db    0x60, 0x30, 0x18, 0x0C, 0x18, 0x30, 0x60, 0x00    
    db    0x78, 0xCC, 0x0C, 0x18, 0x30, 0x00, 0x30, 0x00    
    db    0x7C, 0xC6, 0xDE, 0xDE, 0xDE, 0xC0, 0x78, 0x00    
    db    0x18, 0x3C, 0x66, 0x66, 0x7E, 0x66, 0x66, 0x00    
    db    0x7C, 0x66, 0x66, 0x7C, 0x66, 0x66, 0x7C, 0x00    
    db    0x3C, 0x66, 0xC0, 0xC0, 0xC0, 0x66, 0x3C, 0x00     
    db    0x78, 0x6C, 0x66, 0x66, 0x66, 0x6C, 0x78, 0x00    
    db    0x7E, 0x60, 0x60, 0x78, 0x60, 0x60, 0x7E, 0x00    
    db    0x7E, 0x60, 0x60, 0x78, 0x60, 0x60, 0x60, 0x00    
    db    0x3C, 0x66, 0xC0, 0xC0, 0xCE, 0x66, 0x3E, 0x00    
    db    0x66, 0x66, 0x66, 0x7E, 0x66, 0x66, 0x66, 0x00    
    db    0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x00    
    db    0x06, 0x06, 0x06, 0x06, 0x66, 0x66, 0x3C, 0x00    
    db    0x66, 0x66, 0x6C, 0x78, 0x6C, 0x66, 0x66, 0x00    
    db    0x60, 0x60, 0x60, 0x60, 0x60, 0x60, 0x7E, 0x00    
    db    0xC6, 0xEE, 0xFE, 0xFE, 0xD6, 0xC6, 0xC6, 0x00    
    db    0xC6, 0xE6, 0xF6, 0xDE, 0xCE, 0xC6, 0xC6, 0x00    
    db    0x3C, 0x66, 0x66, 0x66, 0x66, 0x66, 0x3C, 0x00    
    db    0x7C, 0x66, 0x66, 0x7C, 0x60, 0x60, 0x60, 0x00    
    db    0x3C, 0x66, 0x66, 0x66, 0x6E, 0x3C, 0x0E, 0x00    
    db    0x7C, 0x66, 0x66, 0x7C, 0x6C, 0x66, 0x66, 0x00    
    db    0x3C, 0x66, 0x70, 0x38, 0x0E, 0x66, 0x3C, 0x00    
    db    0x7E, 0x18, 0x18, 0x18, 0x18, 0x18, 0x18, 0x00    
    db    0x66, 0x66, 0x66, 0x66, 0x66, 0x66, 0x3E, 0x00    
    db    0x66, 0x66, 0x66, 0x66, 0x66, 0x3C, 0x18, 0x00    
    db    0xC6, 0xC6, 0xC6, 0xD6, 0xFE, 0xEE, 0xC6, 0x00    
    db    0x66, 0x66, 0x3C, 0x18, 0x3C, 0x66, 0x66, 0x00    
    db    0x66, 0x66, 0x66, 0x3C, 0x18, 0x18, 0x18, 0x00    
    db    0xFE, 0x06, 0x0C, 0x18, 0x30, 0x60, 0xFE, 0x00    
    db    0x78, 0x60, 0x60, 0x60, 0x60, 0x60, 0x78, 0x00    
    db    0xC0, 0x60, 0x30, 0x18, 0x0C, 0x06, 0x02, 0x00    
    db    0x78, 0x18, 0x18, 0x18, 0x18, 0x18, 0x78, 0x00    
    db    0x07, 0x0E, 0x39, 0x63, 0x83, 0x31, 0x1C, 0x07   
    db    0xC0, 0xE0, 0x38, 0x8C, 0x82, 0x18, 0x70, 0xC0  

    end
